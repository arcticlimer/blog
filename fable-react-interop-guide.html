<!DOCTYPE html>
<html>
  <title>Fable + React Interop Guide - Vinícius Müller's blog</title>

  <head>
    <link rel="stylesheet" href="https://viniciusmuller.github.io/blog/styles.css"></link>
    
  </head>

  <body>
    
    <nav class="bg-gray-200 w-full px-4 py-2">
      <div class="w-full flex">
          <div class="flex mr-auto space-x-6">
            <a class="text-black font-bold hover:underline" href="https://viniciusmuller.github.io/blog/index.html">Home</a>
            <a class="text-black font-bold hover:underline" href="https://viniciusmuller.github.io/blog/tags.html">Tags</a>

            <!-- <button> -->
            <!--   Search -->
            <!-- </button> -->

            
          </div>

          <div class="flex space-x-6">
            
              <a class="text-black font-bold hover:underline" href="https://github.com/viniciusmuller">GitHub</a>
            

            
              <a class="text-black font-bold hover:underline" href="https://viniciusmuller.github.io/blog/atom.xml">RSS</a>
            
          </div>
        </div>
      </div>
    </nav>
    <main class="p-4 w-full flex justify-center">
      <div class="w-[40vw]">
        
  <div class="flex flex-col items-center">
    <article class='prose my-8'>
      <h1 class="!mb-2">
        Fable + React Interop Guide
      </h1>

      <p>
        <span class="font-bold">
          Vinícius Müller
        </span> on January 25, 2023
      </p>

      <div class="space-x-4">
        
      </div>

      
      

      <div class="mt-8">
        <p>F# has a pretty good interoperability with Javascript when using the Fable
library. When building user interfaces using React, there are multiple
alternatives, but the necessary resources to build solutions using Fable seem
scattered around the internet.</p>
<p>This document aims to provide a solid getting started to both Fable and Feliz,
and how to use both in order to interoperate F# with an existing React library.</p>

          <a class="no-underline" href="#fable">
              <h1 id="fable" class="group relative">
              <span class="hidden group-hover:inline absolute -left-8">#</span>
        Fable</h1></a>
<p><a href="https://fable.io/">Fable</a> is a library that allows one to write F# code while
using existing web solutions in the Javascript ecossystem. It also allows one to
export libraries that can be called from Javascript code.</p>
<p>As seen in &quot;<a href="https://fable.io/docs/communicate/js-from-fable.html">Call JS from
Fable</a>&quot;, there are
multiple ways of importing generic JS objects into our project, this document
will use <code>ImportAttribute</code> to import objects.</p>
<p>Note that by default, we don't have any types when importing and giving data to
JS objects, but we can easily add types on the F# side to have a type-safe
experience when developing with Fable, for example:</p>
<pre><code class="language-ts">// File.ts

interface MyInterface {
  name: string
  lastName: string
}

let myObject: MyInterface = {name: &quot;john&quot;, lastName: &quot;bar&quot;}

export const myObject;
</code></pre>
<pre><code class="language-fsharp">// my-file.fs

type Interface = {
  name: string
  lastName: string
}

[&lt;Import(&quot;default&quot;, from=&quot;./my-file.js&quot;)&gt;]
let myObject: Interface = jsNative

// Now we can use myObject directly from JS in a type-safe way
</code></pre>

          <a class="no-underline" href="#feliz">
              <h1 id="feliz" class="group relative">
              <span class="hidden group-hover:inline absolute -left-8">#</span>
        Feliz</h1></a>
<p><a href="https://zaid-ajaj.github.io/Feliz/">Feliz</a> is a library used to directly
interface React, adding the ability to create new type-safe components directly
by using F# or using already existing components defined in other languages.</p>
<p>We can define new React components in F# using the <code>ReactComponent</code> attribute,
for example:</p>
<pre><code class="language-fsharp">/// &lt;summary&gt;
/// A stateful React component that maintains a counter
/// &lt;/summary&gt;
[&lt;ReactComponent&gt;]
static member Counter() =
    let (count, setCount) = React.useState(0)
    Html.div [
        Html.h1 count
        Html.button [
            prop.onClick (fun _ -&gt; setCount(count + 1))
            prop.text &quot;Increment&quot;
        ]
    ]
</code></pre>
<p>In order to import existing components from other libraries, we also use
<code>&lt;ReactComponent&gt;</code>:</p>
<pre><code class="language-fsharp">[&lt;ReactComponent(import=&quot;default&quot;, from=&quot;react-markdown&quot;)&gt;]
static member Markdown(children: string, remarkPlugins: obj seq) = React.imported()
</code></pre>
<blockquote>
<p>Note that in this case, we pass import=&quot;default&quot; since it is a default export,
when dealing with named exports, import should receive the name of the
exported value.</p>
</blockquote>

          <a class="no-underline" href="#asynchronous-f-code-in-feliz">
              <h1 id="asynchronous-f-code-in-feliz" class="group relative">
              <span class="hidden group-hover:inline absolute -left-8">#</span>
        Asynchronous F# Code in Feliz</h1></a>
<p>Since callbacks can be asynchronous, we use React's <code>useEffect</code> to execute
our asynchronous F# code and set the data that we need using <code>useState</code>.</p>
<p>Below is an example of a Feliz component that fetches products from a remote API
asynchronously and then renders them on screen.</p>
<pre><code class="language-fsharp">[&lt;ReactComponent&gt;]
static member ApiCall() =
    let (products, setProducts) = React.useState([| |])

    let fetchProducts = async {
      let! products = fetch &quot;/api/products&quot;
      setProducts(products)
    } |&gt; Async.StartImmediate

    React.useEffect(fetchProducts, [| |])

    let productElements = List.map products (fun p -&gt; 
      Html.div [
        Html.h2 [
          prop.text p.name
        ]
        Html.p [
          prop.text p.description
        ]
      ]
    )

    Html.div productElements
</code></pre>

      </div>
    </article>
  <div>

      </div>
    </main>
  </body>
</html>